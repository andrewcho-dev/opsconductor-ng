_format_version: "3.0"
_transform: true

services:
  # Identity Service
  - name: identity-service
    url: http://identity-service:3001
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - Authorization
          exposed_headers:
            - Authorization
          credentials: true
          max_age: 3600

  # Asset Service
  - name: asset-service
    url: http://asset-service:3002
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - Authorization
          exposed_headers:
            - Authorization
          credentials: true
          max_age: 3600

  # Automation Service
  - name: automation-service
    url: http://automation-service:3003
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - Authorization
          exposed_headers:
            - Authorization
          credentials: true
          max_age: 3600

  # AI Pipeline Service
  - name: ai-pipeline-service
    url: http://opsconductor-ai-pipeline-dev:8000
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - OPTIONS
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - Authorization
          exposed_headers:
            - Authorization
          credentials: true
          max_age: 3600

routes:
  # Asset Service Routes (must come before identity to match more specific path first)
  - name: asset-routes
    service: asset-service
    paths:
      - /api/v1/assets
    strip_path: true
    preserve_host: false
    regex_priority: 200
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS

  # Identity Service Routes
  - name: identity-auth
    service: identity-service
    paths:
      - /api/v1
    strip_path: true
    regex_priority: 100
    preserve_host: false
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS

  # Automation Service Routes
  - name: automation-routes
    service: automation-service
    paths:
      - /api/automation
    strip_path: true
    preserve_host: false
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS

  # AI Pipeline Routes
  - name: ai-pipeline-routes
    service: ai-pipeline-service
    paths:
      - /api/ai
    strip_path: true
    preserve_host: false
    methods:
      - GET
      - POST
      - OPTIONS