{
  "workflow_export": {
    "format_version": "2.0",
    "exported_at": "2024-01-15T10:30:00Z",
    "exported_by": "admin@company.com",
    "source_system": "automation-prod-01",
    
    "metadata": {
      "name": "Automated Service Management",
      "description": "Monitors IIS service and automatically restarts on failure",
      "version": "1.2",
      "tags": ["service-management", "iis", "auto-recovery"],
      "created_at": "2024-01-10T09:00:00Z",
      "created_by": "ops-team@company.com",
      "last_modified": "2024-01-15T08:45:00Z"
    },

    "requirements": {
      "min_platform_version": "2.0.0",
      "required_features": ["service_monitoring", "target_management"],
      "required_permissions": ["service_control", "service_monitoring"]
    },

    "target_variables": {
      "PRIMARY_WEB_SERVER": {
        "type": "windows_server",
        "description": "Primary IIS web server",
        "required_capabilities": ["service_control", "service_monitoring"],
        "os_requirements": {
          "platform": "windows",
          "min_version": "2016"
        }
      },
      "BACKUP_WEB_SERVER": {
        "type": "windows_server", 
        "description": "Backup IIS web server",
        "required_capabilities": ["service_control"],
        "optional": true
      }
    },

    "configuration_variables": {
      "SERVICE_NAME": {
        "type": "string",
        "default": "IIS",
        "description": "Name of the service to monitor"
      },
      "CHECK_INTERVAL": {
        "type": "integer",
        "default": 30,
        "min": 10,
        "max": 300,
        "description": "Service check interval in seconds"
      },
      "MAX_RESTART_ATTEMPTS": {
        "type": "integer",
        "default": 3,
        "description": "Maximum restart attempts before alerting"
      },
      "NOTIFICATION_EMAIL": {
        "type": "string",
        "format": "email",
        "description": "Email for failure notifications"
      }
    },

    "workflow_definition": {
      "flow_version": 2,
      "blocks": [
        {
          "id": "monitor-1",
          "type": "trigger.service_monitor",
          "position": {"x": 100, "y": 100},
          "config": {
            "target": "{{TARGET_VARIABLES.PRIMARY_WEB_SERVER}}",
            "service_name": "{{CONFIG_VARIABLES.SERVICE_NAME}}",
            "monitor_events": ["stopped", "failed"],
            "check_interval_sec": "{{CONFIG_VARIABLES.CHECK_INTERVAL}}",
            "description": "Monitor primary web server IIS service"
          }
        },
        {
          "id": "start-1",
          "type": "flow.start",
          "position": {"x": 300, "y": 100},
          "config": {
            "name": "Service Recovery Workflow",
            "description": "Automatically recover failed IIS service",
            "trigger_types": ["event", "manual"]
          }
        },
        {
          "id": "counter-1",
          "type": "data.transform",
          "position": {"x": 500, "y": 100},
          "config": {
            "script": "return { ...input, attempt_count: (input.attempt_count || 0) + 1 };",
            "description": "Track restart attempts"
          }
        },
        {
          "id": "check-attempts-1",
          "type": "logic.if",
          "position": {"x": 700, "y": 100},
          "config": {
            "condition": "{{data.attempt_count}} <= {{CONFIG_VARIABLES.MAX_RESTART_ATTEMPTS}}",
            "description": "Check if we should attempt restart"
          }
        },
        {
          "id": "service-check-1",
          "type": "system.service_check",
          "position": {"x": 500, "y": 250},
          "config": {
            "target": "{{TARGET_VARIABLES.PRIMARY_WEB_SERVER}}",
            "service_name": "{{CONFIG_VARIABLES.SERVICE_NAME}}",
            "description": "Verify service status before restart"
          }
        },
        {
          "id": "restart-1",
          "type": "system.service_control",
          "position": {"x": 700, "y": 250},
          "config": {
            "target": "{{TARGET_VARIABLES.PRIMARY_WEB_SERVER}}",
            "service_name": "{{CONFIG_VARIABLES.SERVICE_NAME}}",
            "action": "restart",
            "wait_for_status": "running",
            "timeout_seconds": 60,
            "description": "Restart the failed service"
          }
        },
        {
          "id": "notify-success-1",
          "type": "notification.email",
          "position": {"x": 900, "y": 200},
          "config": {
            "to": "{{CONFIG_VARIABLES.NOTIFICATION_EMAIL}}",
            "subject": "Service Recovery Successful - {{CONFIG_VARIABLES.SERVICE_NAME}}",
            "template": "service_recovery_success",
            "description": "Notify on successful recovery"
          }
        },
        {
          "id": "notify-failure-1", 
          "type": "notification.email",
          "position": {"x": 900, "y": 350},
          "config": {
            "to": "{{CONFIG_VARIABLES.NOTIFICATION_EMAIL}}",
            "subject": "Service Recovery Failed - {{CONFIG_VARIABLES.SERVICE_NAME}}",
            "template": "service_recovery_failure",
            "priority": "high",
            "description": "Notify on recovery failure"
          }
        },
        {
          "id": "end-success-1",
          "type": "flow.end",
          "position": {"x": 1100, "y": 200},
          "config": {
            "name": "Recovery Successful",
            "save_result": true,
            "result_name": "service_recovery_result"
          }
        },
        {
          "id": "end-failure-1",
          "type": "flow.end", 
          "position": {"x": 1100, "y": 350},
          "config": {
            "name": "Recovery Failed",
            "save_result": true,
            "result_name": "service_recovery_failure"
          }
        }
      ],

      "connections": [
        {
          "id": "conn-1",
          "from": {"blockId": "monitor-1", "output": "trigger"},
          "to": {"blockId": "start-1", "input": "event_trigger"},
          "type": "flow"
        },
        {
          "id": "conn-2", 
          "from": {"blockId": "monitor-1", "output": "service_status"},
          "to": {"blockId": "start-1", "input": "trigger_data"},
          "type": "data"
        },
        {
          "id": "conn-3",
          "from": {"blockId": "start-1", "output": "trigger"},
          "to": {"blockId": "counter-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-4",
          "from": {"blockId": "start-1", "output": "context"},
          "to": {"blockId": "counter-1", "input": "input_data"},
          "type": "data"
        },
        {
          "id": "conn-5",
          "from": {"blockId": "counter-1", "output": "success"},
          "to": {"blockId": "check-attempts-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-6",
          "from": {"blockId": "counter-1", "output": "output_data"},
          "to": {"blockId": "check-attempts-1", "input": "data"},
          "type": "data"
        },
        {
          "id": "conn-7",
          "from": {"blockId": "check-attempts-1", "output": "true"},
          "to": {"blockId": "service-check-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-8",
          "from": {"blockId": "check-attempts-1", "output": "false"},
          "to": {"blockId": "notify-failure-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-9",
          "from": {"blockId": "service-check-1", "output": "error"},
          "to": {"blockId": "restart-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-10",
          "from": {"blockId": "restart-1", "output": "success"},
          "to": {"blockId": "notify-success-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-11",
          "from": {"blockId": "restart-1", "output": "error"},
          "to": {"blockId": "counter-1", "input": "trigger"},
          "type": "flow",
          "description": "Retry loop - increment counter and try again"
        },
        {
          "id": "conn-12",
          "from": {"blockId": "notify-success-1", "output": "success"},
          "to": {"blockId": "end-success-1", "input": "trigger"},
          "type": "flow"
        },
        {
          "id": "conn-13",
          "from": {"blockId": "notify-failure-1", "output": "success"},
          "to": {"blockId": "end-failure-1", "input": "trigger"},
          "type": "flow"
        }
      ]
    },

    "import_instructions": {
      "steps": [
        "1. Verify platform version compatibility",
        "2. Map target variables to actual targets in your environment", 
        "3. Configure notification settings",
        "4. Review and adjust configuration variables",
        "5. Test workflow in safe environment before production use"
      ],
      "validation_required": [
        "target_capabilities",
        "service_permissions", 
        "notification_endpoints"
      ]
    }
  }
}